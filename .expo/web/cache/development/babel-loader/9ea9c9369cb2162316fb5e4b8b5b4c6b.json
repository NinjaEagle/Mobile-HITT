{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getCustomTabsSupportingBrowsersAsync = getCustomTabsSupportingBrowsersAsync;\nexports.warmUpAsync = warmUpAsync;\nexports.mayInitWithUrlAsync = mayInitWithUrlAsync;\nexports.coolDownAsync = coolDownAsync;\nexports.openBrowserAsync = openBrowserAsync;\nexports.dismissBrowser = dismissBrowser;\nexports.openAuthSessionAsync = openAuthSessionAsync;\nexports.dismissAuthSession = dismissAuthSession;\nexports.maybeCompleteAuthSession = maybeCompleteAuthSession;\nObject.defineProperty(exports, \"WebBrowserResultType\", {\n  enumerable: true,\n  get: function get() {\n    return _WebBrowser.WebBrowserResultType;\n  }\n});\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _core = require(\"@unimodules/core\");\n\nvar _reactNative = require(\"react-native\");\n\nvar _ExpoWebBrowser = _interopRequireDefault(require(\"./ExpoWebBrowser\"));\n\nvar _WebBrowser = require(\"./WebBrowser.types\");\n\nvar emptyCustomTabsPackages = {\n  defaultBrowserPackage: undefined,\n  preferredBrowserPackage: undefined,\n  browserPackages: [],\n  servicePackages: []\n};\n\nfunction getCustomTabsSupportingBrowsersAsync() {\n  return _regenerator.default.async(function getCustomTabsSupportingBrowsersAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (_ExpoWebBrowser.default.getCustomTabsSupportingBrowsersAsync) {\n            _context.next = 2;\n            break;\n          }\n\n          throw new _core.UnavailabilityError('WebBrowser', 'getCustomTabsSupportingBrowsersAsync');\n\n        case 2:\n          if (!(_reactNative.Platform.OS !== 'android')) {\n            _context.next = 6;\n            break;\n          }\n\n          return _context.abrupt(\"return\", emptyCustomTabsPackages);\n\n        case 6:\n          _context.next = 8;\n          return _regenerator.default.awrap(_ExpoWebBrowser.default.getCustomTabsSupportingBrowsersAsync());\n\n        case 8:\n          return _context.abrupt(\"return\", _context.sent);\n\n        case 9:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction warmUpAsync(browserPackage) {\n  return _regenerator.default.async(function warmUpAsync$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          if (_ExpoWebBrowser.default.warmUpAsync) {\n            _context2.next = 2;\n            break;\n          }\n\n          throw new _core.UnavailabilityError('WebBrowser', 'warmUpAsync');\n\n        case 2:\n          if (!(_reactNative.Platform.OS !== 'android')) {\n            _context2.next = 6;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", {});\n\n        case 6:\n          _context2.next = 8;\n          return _regenerator.default.awrap(_ExpoWebBrowser.default.warmUpAsync(browserPackage));\n\n        case 8:\n          return _context2.abrupt(\"return\", _context2.sent);\n\n        case 9:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction mayInitWithUrlAsync(url, browserPackage) {\n  return _regenerator.default.async(function mayInitWithUrlAsync$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          if (_ExpoWebBrowser.default.mayInitWithUrlAsync) {\n            _context3.next = 2;\n            break;\n          }\n\n          throw new _core.UnavailabilityError('WebBrowser', 'mayInitWithUrlAsync');\n\n        case 2:\n          if (!(_reactNative.Platform.OS !== 'android')) {\n            _context3.next = 6;\n            break;\n          }\n\n          return _context3.abrupt(\"return\", {});\n\n        case 6:\n          _context3.next = 8;\n          return _regenerator.default.awrap(_ExpoWebBrowser.default.mayInitWithUrlAsync(url, browserPackage));\n\n        case 8:\n          return _context3.abrupt(\"return\", _context3.sent);\n\n        case 9:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction coolDownAsync(browserPackage) {\n  return _regenerator.default.async(function coolDownAsync$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          if (_ExpoWebBrowser.default.coolDownAsync) {\n            _context4.next = 2;\n            break;\n          }\n\n          throw new _core.UnavailabilityError('WebBrowser', 'coolDownAsync');\n\n        case 2:\n          if (!(_reactNative.Platform.OS !== 'android')) {\n            _context4.next = 6;\n            break;\n          }\n\n          return _context4.abrupt(\"return\", {});\n\n        case 6:\n          _context4.next = 8;\n          return _regenerator.default.awrap(_ExpoWebBrowser.default.coolDownAsync(browserPackage));\n\n        case 8:\n          return _context4.abrupt(\"return\", _context4.sent);\n\n        case 9:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction openBrowserAsync(url) {\n  var browserParams,\n      _args5 = arguments;\n  return _regenerator.default.async(function openBrowserAsync$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          browserParams = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {};\n\n          if (_ExpoWebBrowser.default.openBrowserAsync) {\n            _context5.next = 3;\n            break;\n          }\n\n          throw new _core.UnavailabilityError('WebBrowser', 'openBrowserAsync');\n\n        case 3:\n          _context5.next = 5;\n          return _regenerator.default.awrap(_ExpoWebBrowser.default.openBrowserAsync(url, browserParams));\n\n        case 5:\n          return _context5.abrupt(\"return\", _context5.sent);\n\n        case 6:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction dismissBrowser() {\n  if (!_ExpoWebBrowser.default.dismissBrowser) {\n    throw new _core.UnavailabilityError('WebBrowser', 'dismissBrowser');\n  }\n\n  _ExpoWebBrowser.default.dismissBrowser();\n}\n\nfunction openAuthSessionAsync(url, redirectUrl) {\n  var browserParams,\n      _args6 = arguments;\n  return _regenerator.default.async(function openAuthSessionAsync$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          browserParams = _args6.length > 2 && _args6[2] !== undefined ? _args6[2] : {};\n\n          if (!_authSessionIsNativelySupported()) {\n            _context6.next = 7;\n            break;\n          }\n\n          if (_ExpoWebBrowser.default.openAuthSessionAsync) {\n            _context6.next = 4;\n            break;\n          }\n\n          throw new _core.UnavailabilityError('WebBrowser', 'openAuthSessionAsync');\n\n        case 4:\n          return _context6.abrupt(\"return\", _ExpoWebBrowser.default.openAuthSessionAsync(url, redirectUrl));\n\n        case 7:\n          return _context6.abrupt(\"return\", _openAuthSessionPolyfillAsync(url, redirectUrl, browserParams));\n\n        case 8:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction dismissAuthSession() {\n  if (_authSessionIsNativelySupported()) {\n    if (!_ExpoWebBrowser.default.dismissAuthSession) {\n      throw new _core.UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n\n    _ExpoWebBrowser.default.dismissAuthSession();\n  } else {\n    if (!_ExpoWebBrowser.default.dismissBrowser) {\n      throw new _core.UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n\n    _ExpoWebBrowser.default.dismissBrowser();\n  }\n}\n\nfunction maybeCompleteAuthSession() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (_ExpoWebBrowser.default.maybeCompleteAuthSession) {\n    return _ExpoWebBrowser.default.maybeCompleteAuthSession(options);\n  }\n\n  return {\n    type: 'failed',\n    message: 'Not supported on this platform'\n  };\n}\n\nfunction _authSessionIsNativelySupported() {\n  if (_reactNative.Platform.OS === 'android') {\n    return false;\n  } else if (_reactNative.Platform.OS === 'web') {\n    return true;\n  }\n\n  var versionNumber = parseInt(String(_reactNative.Platform.Version), 10);\n  return versionNumber >= 11;\n}\n\nvar _redirectHandler = null;\nvar _onWebBrowserCloseAndroid = null;\n\nvar _isAppStateAvailable = _reactNative.AppState.currentState !== null;\n\nfunction _onAppStateChangeAndroid(state) {\n  if (!_isAppStateAvailable) {\n    _isAppStateAvailable = true;\n    return;\n  }\n\n  if (state === 'active' && _onWebBrowserCloseAndroid) {\n    _onWebBrowserCloseAndroid();\n  }\n}\n\nfunction _openBrowserAndWaitAndroidAsync(startUrl) {\n  var browserParams,\n      appStateChangedToActive,\n      result,\n      _await$openBrowserAsy,\n      type,\n      _args7 = arguments;\n\n  return _regenerator.default.async(function _openBrowserAndWaitAndroidAsync$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          browserParams = _args7.length > 1 && _args7[1] !== undefined ? _args7[1] : {};\n          appStateChangedToActive = new Promise(function (resolve) {\n            _onWebBrowserCloseAndroid = resolve;\n\n            _reactNative.AppState.addEventListener('change', _onAppStateChangeAndroid);\n          });\n          result = {\n            type: 'cancel'\n          };\n          _context7.next = 5;\n          return _regenerator.default.awrap(openBrowserAsync(startUrl, browserParams));\n\n        case 5:\n          _await$openBrowserAsy = _context7.sent;\n          type = _await$openBrowserAsy.type;\n\n          if (!(type === 'opened')) {\n            _context7.next = 11;\n            break;\n          }\n\n          _context7.next = 10;\n          return _regenerator.default.awrap(appStateChangedToActive);\n\n        case 10:\n          result = {\n            type: 'dismiss'\n          };\n\n        case 11:\n          _reactNative.AppState.removeEventListener('change', _onAppStateChangeAndroid);\n\n          _onWebBrowserCloseAndroid = null;\n          return _context7.abrupt(\"return\", result);\n\n        case 14:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction _openAuthSessionPolyfillAsync(startUrl, returnUrl) {\n  var browserParams,\n      _args8 = arguments;\n  return _regenerator.default.async(function _openAuthSessionPolyfillAsync$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          browserParams = _args8.length > 2 && _args8[2] !== undefined ? _args8[2] : {};\n\n          if (!_redirectHandler) {\n            _context8.next = 3;\n            break;\n          }\n\n          throw new Error(\"The WebBrowser's auth session is in an invalid state with a redirect handler set when it should not be\");\n\n        case 3:\n          if (!_onWebBrowserCloseAndroid) {\n            _context8.next = 5;\n            break;\n          }\n\n          throw new Error(\"WebBrowser is already open, only one can be open at a time\");\n\n        case 5:\n          _context8.prev = 5;\n\n          if (!(_reactNative.Platform.OS === 'android')) {\n            _context8.next = 12;\n            break;\n          }\n\n          _context8.next = 9;\n          return _regenerator.default.awrap(Promise.race([_openBrowserAndWaitAndroidAsync(startUrl, browserParams), _waitForRedirectAsync(returnUrl)]));\n\n        case 9:\n          return _context8.abrupt(\"return\", _context8.sent);\n\n        case 12:\n          _context8.next = 14;\n          return _regenerator.default.awrap(Promise.race([openBrowserAsync(startUrl, browserParams), _waitForRedirectAsync(returnUrl)]));\n\n        case 14:\n          return _context8.abrupt(\"return\", _context8.sent);\n\n        case 15:\n          _context8.prev = 15;\n\n          if (_ExpoWebBrowser.default.dismissBrowser) {\n            _ExpoWebBrowser.default.dismissBrowser();\n          }\n\n          _stopWaitingForRedirect();\n\n          return _context8.finish(15);\n\n        case 19:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, [[5,, 15, 19]], Promise);\n}\n\nfunction _stopWaitingForRedirect() {\n  if (!_redirectHandler) {\n    throw new Error(\"The WebBrowser auth session is in an invalid state with no redirect handler when one should be set\");\n  }\n\n  _reactNative.Linking.removeEventListener('url', _redirectHandler);\n\n  _redirectHandler = null;\n}\n\nfunction _waitForRedirectAsync(returnUrl) {\n  return new Promise(function (resolve) {\n    _redirectHandler = function _redirectHandler(event) {\n      if (event.url.startsWith(returnUrl)) {\n        resolve({\n          url: event.url,\n          type: 'success'\n        });\n      }\n    };\n\n    _reactNative.Linking.addEventListener('url', _redirectHandler);\n  });\n}","map":{"version":3,"sources":["../src/WebBrowser.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;AAyBA,IAAM,uBAAuB,GAAgC;AAC3D,EAAA,qBAAqB,EAAE,SADoC;AAE3D,EAAA,uBAAuB,EAAE,SAFkC;AAG3D,EAAA,eAAe,EAAE,EAH0C;AAI3D,EAAA,eAAe,EAAE;AAJ0C,CAA7D;;AAOO,SAAe,oCAAf;AAAA;AAAA;AAAA;AAAA;AAAA,cACA,wBAAmB,oCADnB;AAAA;AAAA;AAAA;;AAAA,gBAEG,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,sCAAtC,CAFH;;AAAA;AAAA,gBAID,sBAAS,EAAT,KAAgB,SAJf;AAAA;AAAA;AAAA;;AAAA,2CAKI,uBALJ;;AAAA;AAAA;AAAA,4CAOU,wBAAmB,oCAAnB,EAPV;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAWA,SAAe,WAAf,CAA2B,cAA3B;AAAA;AAAA;AAAA;AAAA;AAAA,cACA,wBAAmB,WADnB;AAAA;AAAA;AAAA;;AAAA,gBAEG,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,aAAtC,CAFH;;AAAA;AAAA,gBAID,sBAAS,EAAT,KAAgB,SAJf;AAAA;AAAA;AAAA;;AAAA,4CAKI,EALJ;;AAAA;AAAA;AAAA,4CAOU,wBAAmB,WAAnB,CAA+B,cAA/B,CAPV;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAWA,SAAe,mBAAf,CACL,GADK,EAEL,cAFK;AAAA;AAAA;AAAA;AAAA;AAAA,cAIA,wBAAmB,mBAJnB;AAAA;AAAA;AAAA;;AAAA,gBAKG,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,qBAAtC,CALH;;AAAA;AAAA,gBAOD,sBAAS,EAAT,KAAgB,SAPf;AAAA;AAAA;AAAA;;AAAA,4CAQI,EARJ;;AAAA;AAAA;AAAA,4CAUU,wBAAmB,mBAAnB,CAAuC,GAAvC,EAA4C,cAA5C,CAVV;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAcA,SAAe,aAAf,CAA6B,cAA7B;AAAA;AAAA;AAAA;AAAA;AAAA,cACA,wBAAmB,aADnB;AAAA;AAAA;AAAA;;AAAA,gBAEG,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,eAAtC,CAFH;;AAAA;AAAA,gBAID,sBAAS,EAAT,KAAgB,SAJf;AAAA;AAAA;AAAA;;AAAA,4CAKI,EALJ;;AAAA;AAAA;AAAA,4CAOU,wBAAmB,aAAnB,CAAiC,cAAjC,CAPV;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAWA,SAAe,gBAAf,CACL,GADK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEL,UAAA,aAFK,8DAEkC,EAFlC;;AAAA,cAIA,wBAAmB,gBAJnB;AAAA;AAAA;AAAA;;AAAA,gBAKG,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,kBAAtC,CALH;;AAAA;AAAA;AAAA,4CAOQ,wBAAmB,gBAAnB,CAAoC,GAApC,EAAyC,aAAzC,CAPR;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAUD,SAAU,cAAV,GAAwB;AAC5B,MAAI,CAAC,wBAAmB,cAAxB,EAAwC;AACtC,UAAM,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,gBAAtC,CAAN;AACD;;AACD,0BAAmB,cAAnB;AACD;;AAEM,SAAe,oBAAf,CACL,GADK,EAEL,WAFK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGL,UAAA,aAHK,8DAGkC,EAHlC;;AAAA,eAKD,+BAA+B,EAL9B;AAAA;AAAA;AAAA;;AAAA,cAME,wBAAmB,oBANrB;AAAA;AAAA;AAAA;;AAAA,gBAOK,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,sBAAtC,CAPL;;AAAA;AAAA,4CASI,wBAAmB,oBAAnB,CAAwC,GAAxC,EAA6C,WAA7C,CATJ;;AAAA;AAAA,4CAWI,6BAA6B,CAAC,GAAD,EAAM,WAAN,EAAmB,aAAnB,CAXjC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAeD,SAAU,kBAAV,GAA4B;AAChC,MAAI,+BAA+B,EAAnC,EAAuC;AACrC,QAAI,CAAC,wBAAmB,kBAAxB,EAA4C;AAC1C,YAAM,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,oBAAtC,CAAN;AACD;;AACD,4BAAmB,kBAAnB;AACD,GALD,MAKO;AACL,QAAI,CAAC,wBAAmB,cAAxB,EAAwC;AACtC,YAAM,IAAI,yBAAJ,CAAwB,YAAxB,EAAsC,oBAAtC,CAAN;AACD;;AACD,4BAAmB,cAAnB;AACD;AACF;;AAOK,SAAU,wBAAV,GACyC;AAAA,MAA7C,OAA6C,uEAAF,EAAE;;AAE7C,MAAI,wBAAmB,wBAAvB,EAAiD;AAC/C,WAAO,wBAAmB,wBAAnB,CAA4C,OAA5C,CAAP;AACD;;AACD,SAAO;AAAE,IAAA,IAAI,EAAE,QAAR;AAAkB,IAAA,OAAO,EAAE;AAA3B,GAAP;AACD;;AAID,SAAS,+BAAT,GAAwC;AACtC,MAAI,sBAAS,EAAT,KAAgB,SAApB,EAA+B;AAC7B,WAAO,KAAP;AACD,GAFD,MAEO,IAAI,sBAAS,EAAT,KAAgB,KAApB,EAA2B;AAChC,WAAO,IAAP;AACD;;AAED,MAAM,aAAa,GAAG,QAAQ,CAAC,MAAM,CAAC,sBAAS,OAAV,CAAP,EAA2B,EAA3B,CAA9B;AACA,SAAO,aAAa,IAAI,EAAxB;AACD;;AAED,IAAI,gBAAgB,GAA4C,IAAhE;AASA,IAAI,yBAAyB,GAAwB,IAArD;;AAMA,IAAI,oBAAoB,GAAY,sBAAS,YAAT,KAA0B,IAA9D;;AACA,SAAS,wBAAT,CAAkC,KAAlC,EAAuD;AACrD,MAAI,CAAC,oBAAL,EAA2B;AACzB,IAAA,oBAAoB,GAAG,IAAvB;AACA;AACD;;AAED,MAAI,KAAK,KAAK,QAAV,IAAsB,yBAA1B,EAAqD;AACnD,IAAA,yBAAyB;AAC1B;AACF;;AAED,SAAe,+BAAf,CACE,QADF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAEE,UAAA,aAFF,8DAEyC,EAFzC;AAIQ,UAAA,uBAJR,GAIkC,IAAI,OAAJ,CAAY,UAAA,OAAO,EAAG;AACpD,YAAA,yBAAyB,GAAG,OAA5B;;AACA,kCAAS,gBAAT,CAA0B,QAA1B,EAAoC,wBAApC;AACD,WAH+B,CAJlC;AASM,UAAA,MATN,GASiC;AAAE,YAAA,IAAI,EAAE;AAAR,WATjC;AAAA;AAAA,4CAUyB,gBAAgB,CAAC,QAAD,EAAW,aAAX,CAVzC;;AAAA;AAAA;AAUU,UAAA,IAVV,yBAUU,IAVV;;AAAA,gBAYM,IAAI,KAAK,QAZf;AAAA;AAAA;AAAA;;AAAA;AAAA,4CAaU,uBAbV;;AAAA;AAcI,UAAA,MAAM,GAAG;AAAE,YAAA,IAAI,EAAE;AAAR,WAAT;;AAdJ;AAiBE,gCAAS,mBAAT,CAA6B,QAA7B,EAAuC,wBAAvC;;AACA,UAAA,yBAAyB,GAAG,IAA5B;AAlBF,4CAmBS,MAnBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAsBA,SAAe,6BAAf,CACE,QADF,EAEE,SAFF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGE,UAAA,aAHF,8DAGyC,EAHzC;;AAAA,eAKM,gBALN;AAAA;AAAA;AAAA;;AAAA,gBAMU,IAAI,KAAJ,0GANV;;AAAA;AAAA,eAWM,yBAXN;AAAA;AAAA;AAAA;;AAAA,gBAYU,IAAI,KAAJ,8DAZV;;AAAA;AAAA;;AAAA,gBAgBQ,sBAAS,EAAT,KAAgB,SAhBxB;AAAA;AAAA;AAAA;;AAAA;AAAA,4CAiBmB,OAAO,CAAC,IAAR,CAAa,CACxB,+BAA+B,CAAC,QAAD,EAAW,aAAX,CADP,EAExB,qBAAqB,CAAC,SAAD,CAFG,CAAb,CAjBnB;;AAAA;AAAA;;AAAA;AAAA;AAAA,4CAsBmB,OAAO,CAAC,IAAR,CAAa,CACxB,gBAAgB,CAAC,QAAD,EAAW,aAAX,CADQ,EAExB,qBAAqB,CAAC,SAAD,CAFG,CAAb,CAtBnB;;AAAA;AAAA;;AAAA;AAAA;;AA8BI,cAAI,wBAAmB,cAAvB,EAAuC;AACrC,oCAAmB,cAAnB;AACD;;AAED,UAAA,uBAAuB;;AAlC3B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAsCA,SAAS,uBAAT,GAAgC;AAC9B,MAAI,CAAC,gBAAL,EAAuB;AACrB,UAAM,IAAI,KAAJ,sGAAN;AAGD;;AAED,uBAAQ,mBAAR,CAA4B,KAA5B,EAAmC,gBAAnC;;AACA,EAAA,gBAAgB,GAAG,IAAnB;AACD;;AAED,SAAS,qBAAT,CAA+B,SAA/B,EAAgD;AAC9C,SAAO,IAAI,OAAJ,CAAY,UAAA,OAAO,EAAG;AAC3B,IAAA,gBAAgB,GAAG,0BAAC,KAAD,EAAyB;AAC1C,UAAI,KAAK,CAAC,GAAN,CAAU,UAAV,CAAqB,SAArB,CAAJ,EAAqC;AACnC,QAAA,OAAO,CAAC;AAAE,UAAA,GAAG,EAAE,KAAK,CAAC,GAAb;AAAkB,UAAA,IAAI,EAAE;AAAxB,SAAD,CAAP;AACD;AACF,KAJD;;AAMA,yBAAQ,gBAAR,CAAyB,KAAzB,EAAgC,gBAAhC;AACD,GARM,CAAP;AASD","sourcesContent":["import { UnavailabilityError } from '@unimodules/core';\nimport { AppState, Linking, Platform, AppStateStatus } from 'react-native';\n\nimport ExponentWebBrowser from './ExpoWebBrowser';\nimport {\n  RedirectEvent,\n  WebBrowserOpenOptions,\n  WebBrowserAuthSessionResult,\n  WebBrowserCustomTabsResults,\n  WebBrowserResult,\n  WebBrowserRedirectResult,\n  WebBrowserMayInitWithUrlResult,\n  WebBrowserWarmUpResult,\n  WebBrowserCoolDownResult,\n  WebBrowserResultType,\n} from './WebBrowser.types';\n\nexport {\n  WebBrowserOpenOptions,\n  WebBrowserAuthSessionResult,\n  WebBrowserCustomTabsResults,\n  WebBrowserResult,\n  WebBrowserRedirectResult,\n  WebBrowserMayInitWithUrlResult,\n  WebBrowserWarmUpResult,\n  WebBrowserCoolDownResult,\n  WebBrowserResultType,\n};\n\nconst emptyCustomTabsPackages: WebBrowserCustomTabsResults = {\n  defaultBrowserPackage: undefined,\n  preferredBrowserPackage: undefined,\n  browserPackages: [],\n  servicePackages: [],\n};\n\nexport async function getCustomTabsSupportingBrowsersAsync(): Promise<WebBrowserCustomTabsResults> {\n  if (!ExponentWebBrowser.getCustomTabsSupportingBrowsersAsync) {\n    throw new UnavailabilityError('WebBrowser', 'getCustomTabsSupportingBrowsersAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return emptyCustomTabsPackages;\n  } else {\n    return await ExponentWebBrowser.getCustomTabsSupportingBrowsersAsync();\n  }\n}\n\nexport async function warmUpAsync(browserPackage?: string): Promise<WebBrowserWarmUpResult> {\n  if (!ExponentWebBrowser.warmUpAsync) {\n    throw new UnavailabilityError('WebBrowser', 'warmUpAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return {};\n  } else {\n    return await ExponentWebBrowser.warmUpAsync(browserPackage);\n  }\n}\n\nexport async function mayInitWithUrlAsync(\n  url: string,\n  browserPackage?: string\n): Promise<WebBrowserMayInitWithUrlResult> {\n  if (!ExponentWebBrowser.mayInitWithUrlAsync) {\n    throw new UnavailabilityError('WebBrowser', 'mayInitWithUrlAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return {};\n  } else {\n    return await ExponentWebBrowser.mayInitWithUrlAsync(url, browserPackage);\n  }\n}\n\nexport async function coolDownAsync(browserPackage?: string): Promise<WebBrowserCoolDownResult> {\n  if (!ExponentWebBrowser.coolDownAsync) {\n    throw new UnavailabilityError('WebBrowser', 'coolDownAsync');\n  }\n  if (Platform.OS !== 'android') {\n    return {};\n  } else {\n    return await ExponentWebBrowser.coolDownAsync(browserPackage);\n  }\n}\n\nexport async function openBrowserAsync(\n  url: string,\n  browserParams: WebBrowserOpenOptions = {}\n): Promise<WebBrowserResult> {\n  if (!ExponentWebBrowser.openBrowserAsync) {\n    throw new UnavailabilityError('WebBrowser', 'openBrowserAsync');\n  }\n  return await ExponentWebBrowser.openBrowserAsync(url, browserParams);\n}\n\nexport function dismissBrowser(): void {\n  if (!ExponentWebBrowser.dismissBrowser) {\n    throw new UnavailabilityError('WebBrowser', 'dismissBrowser');\n  }\n  ExponentWebBrowser.dismissBrowser();\n}\n\nexport async function openAuthSessionAsync(\n  url: string,\n  redirectUrl: string,\n  browserParams: WebBrowserOpenOptions = {}\n): Promise<WebBrowserAuthSessionResult> {\n  if (_authSessionIsNativelySupported()) {\n    if (!ExponentWebBrowser.openAuthSessionAsync) {\n      throw new UnavailabilityError('WebBrowser', 'openAuthSessionAsync');\n    }\n    return ExponentWebBrowser.openAuthSessionAsync(url, redirectUrl);\n  } else {\n    return _openAuthSessionPolyfillAsync(url, redirectUrl, browserParams);\n  }\n}\n\nexport function dismissAuthSession(): void {\n  if (_authSessionIsNativelySupported()) {\n    if (!ExponentWebBrowser.dismissAuthSession) {\n      throw new UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n    ExponentWebBrowser.dismissAuthSession();\n  } else {\n    if (!ExponentWebBrowser.dismissBrowser) {\n      throw new UnavailabilityError('WebBrowser', 'dismissAuthSession');\n    }\n    ExponentWebBrowser.dismissBrowser();\n  }\n}\n\n/**\n * Attempts to complete an auth session in the browser.\n *\n * @param options\n */\nexport function maybeCompleteAuthSession(\n  options: { skipRedirectCheck?: boolean } = {}\n): { type: 'success' | 'failed'; message: string } {\n  if (ExponentWebBrowser.maybeCompleteAuthSession) {\n    return ExponentWebBrowser.maybeCompleteAuthSession(options);\n  }\n  return { type: 'failed', message: 'Not supported on this platform' };\n}\n\n/* iOS <= 10 and Android polyfill for SFAuthenticationSession flow */\n\nfunction _authSessionIsNativelySupported(): boolean {\n  if (Platform.OS === 'android') {\n    return false;\n  } else if (Platform.OS === 'web') {\n    return true;\n  }\n\n  const versionNumber = parseInt(String(Platform.Version), 10);\n  return versionNumber >= 11;\n}\n\nlet _redirectHandler: ((event: RedirectEvent) => void) | null = null;\n\n/*\n * openBrowserAsync on Android doesn't wait until closed, so we need to polyfill\n * it with AppState\n */\n\n// Store the `resolve` function from a Promise to fire when the AppState\n// returns to active\nlet _onWebBrowserCloseAndroid: null | (() => void) = null;\n\n// If the initial AppState.currentState is null, we assume that the first call to\n// AppState#change event is not actually triggered by a real change,\n// is triggered instead by the bridge capturing the current state\n// (https://facebook.github.io/react-native/docs/appstate#basic-usage)\nlet _isAppStateAvailable: boolean = AppState.currentState !== null;\nfunction _onAppStateChangeAndroid(state: AppStateStatus) {\n  if (!_isAppStateAvailable) {\n    _isAppStateAvailable = true;\n    return;\n  }\n\n  if (state === 'active' && _onWebBrowserCloseAndroid) {\n    _onWebBrowserCloseAndroid();\n  }\n}\n\nasync function _openBrowserAndWaitAndroidAsync(\n  startUrl: string,\n  browserParams: WebBrowserOpenOptions = {}\n): Promise<WebBrowserResult> {\n  const appStateChangedToActive = new Promise(resolve => {\n    _onWebBrowserCloseAndroid = resolve;\n    AppState.addEventListener('change', _onAppStateChangeAndroid);\n  });\n\n  let result: WebBrowserResult = { type: 'cancel' };\n  const { type } = await openBrowserAsync(startUrl, browserParams);\n\n  if (type === 'opened') {\n    await appStateChangedToActive;\n    result = { type: 'dismiss' };\n  }\n\n  AppState.removeEventListener('change', _onAppStateChangeAndroid);\n  _onWebBrowserCloseAndroid = null;\n  return result;\n}\n\nasync function _openAuthSessionPolyfillAsync(\n  startUrl: string,\n  returnUrl: string,\n  browserParams: WebBrowserOpenOptions = {}\n): Promise<WebBrowserAuthSessionResult> {\n  if (_redirectHandler) {\n    throw new Error(\n      `The WebBrowser's auth session is in an invalid state with a redirect handler set when it should not be`\n    );\n  }\n\n  if (_onWebBrowserCloseAndroid) {\n    throw new Error(`WebBrowser is already open, only one can be open at a time`);\n  }\n\n  try {\n    if (Platform.OS === 'android') {\n      return await Promise.race([\n        _openBrowserAndWaitAndroidAsync(startUrl, browserParams),\n        _waitForRedirectAsync(returnUrl),\n      ]);\n    } else {\n      return await Promise.race([\n        openBrowserAsync(startUrl, browserParams),\n        _waitForRedirectAsync(returnUrl),\n      ]);\n    }\n  } finally {\n    // We can't dismiss the browser on Android, only call this when it's available.\n    // Users on Android need to manually press the 'x' button in Chrome Custom Tabs, sadly.\n    if (ExponentWebBrowser.dismissBrowser) {\n      ExponentWebBrowser.dismissBrowser();\n    }\n\n    _stopWaitingForRedirect();\n  }\n}\n\nfunction _stopWaitingForRedirect() {\n  if (!_redirectHandler) {\n    throw new Error(\n      `The WebBrowser auth session is in an invalid state with no redirect handler when one should be set`\n    );\n  }\n\n  Linking.removeEventListener('url', _redirectHandler);\n  _redirectHandler = null;\n}\n\nfunction _waitForRedirectAsync(returnUrl: string): Promise<WebBrowserRedirectResult> {\n  return new Promise(resolve => {\n    _redirectHandler = (event: RedirectEvent) => {\n      if (event.url.startsWith(returnUrl)) {\n        resolve({ url: event.url, type: 'success' });\n      }\n    };\n\n    Linking.addEventListener('url', _redirectHandler);\n  });\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}